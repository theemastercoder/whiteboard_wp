<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Polo Tactic Board</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f8ff;
        }
        .tactic-board {
            position: relative;
            width: 90%;
            max-width: 730px;
            aspect-ratio: 4 / 3;
            background-color: #add8e6;
            border: 2px solid #000;
            margin-bottom: 20px;
            cursor: crosshair;
        }
        .line {
            position: absolute;
            width: 100%;
            height: 0.5%;
            background-color: #000;
        }
        .two-meter { top: 13%; }
        .six-meter { top: 40%; }
        .goal {
            position: absolute;
            width: 20%;
            height: 7%;
            background-color: #ff4500;
            top: -6%;
            left: 40%;
        }
        .player, .ball, .goalie {
            position: absolute;
            cursor: pointer;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        .player {
            width: 5%;
            height: 5%;
            border: 2px solid #000;
        }
        .team1 { background-color: #ffcc00; }
        .team2 { background-color: #00bfff; }
        .ball {
            width: 3%;
            height: 3%;
            background-color: #ff4500;
            border: 2px solid #000;
        }
        .goalie {
            width: 5%;
            height: 5%;
            background-color: #32cd32;
            border: 2px solid #000;
        }
        button {
            padding: 10px 20px;
            font-size: 1rem;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        #settingsTab {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffffff;
            border: 1px solid #ddd;
            padding: 20px;
            display: none;
            width: 250px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        .setting {
            margin-bottom: 15px;
        }
        .setting label {
            display: block;
            margin-bottom: 5px;
        }
        .setting input[type="range"],
        .setting input[type="color"] {
            width: 100%;
        }
        .setting button {
            width: 100%;
            margin-top: 10px;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="tactic-board" id="tacticBoard">
        <canvas id="drawingCanvas"></canvas>
        <div class="line two-meter"></div>
        <div class="line six-meter"></div>
        <div class="goal"></div>
        <div class="player team1" data-start-top="13%" data-start-left="12%" style="top: 13%; left: 12%;"></div>
        <div class="player team1" data-start-top="13%" data-start-left="88%" style="top: 13%; left: 88%;"></div>
        <div class="player team1" data-start-top="35%" data-start-left="25%" style="top: 35%; left: 25%;"></div>
        <div class="player team1" data-start-top="35%" data-start-left="75%" style="top: 35%; left: 75%;"></div>
        <div class="player team1" data-start-top="45%" data-start-left="50%" style="top: 45%; left: 50%;"></div>
        <div class="player team1" data-start-top="20%" data-start-left="50%" style="top: 20%; left: 50%;"></div>
        <div class="player team2" data-start-top="13%" data-start-left="18%" style="top: 13%; left: 18%;"></div>
        <div class="player team2" data-start-top="13%" data-start-left="82%" style="top: 13%; left: 82%;"></div>
        <div class="player team2" data-start-top="32%" data-start-left="30%" style="top: 32%; left: 30%;"></div>
        <div class="player team2" data-start-top="32%" data-start-left="70%" style="top: 32%; left: 70%;"></div>
        <div class="player team2" data-start-top="38%" data-start-left="50%" style="top: 38%; left: 50%;"></div>
        <div class="player team2" data-start-top="12%" data-start-left="50%" style="top: 12%; left: 50%;"></div>
        <div class="ball" id="ball" data-start-top="48%" data-start-left="50%" style="top: 48%; left: 50%;"></div>
        <div class="goalie" id="goalie" data-start-top="5%" data-start-left="50%" style="top: 5%; left: 50%;"></div>
    </div>
    <button id="settingsButton">Settings</button>
    <button id="resetButton">Reset Positions</button>
    <div id="settingsTab">
        <div class="setting">
            <label for="colorPicker">Line Color</label>
            <input type="color" id="colorPicker" value="#000000">
        </div>
        <div class="setting">
            <label for="lineThickness">Line Thickness</label>
            <input type="range" id="lineThickness" min="1" max="10" value="2">
        </div>
        <div class="setting">
            <label for="drawingMode">Drawing Mode</label>
            <select id="drawingMode">
                <option value="freehand">Freehand</option>
                <option value="straight">Straight Line</option>
            </select>
        </div>
        <button id="closeSettings">Close Settings</button>
    </div>
    <script>

const elements = document.querySelectorAll('.player, .ball, .goalie');
const resetButton = document.getElementById('resetButton');
const settingsButton = document.getElementById('settingsButton');
const settingsTab = document.getElementById('settingsTab');
const closeSettingsButton = document.getElementById('closeSettings');
const colorPicker = document.getElementById('colorPicker');
const lineThicknessSlider = document.getElementById('lineThickness');
const drawingModeSelector = document.getElementById('drawingMode');
const tacticBoard = document.getElementById('tacticBoard');
const canvas = document.getElementById('drawingCanvas');
const ctx = canvas.getContext('2d');
let isDraggingElement = false;
let drawingMode = 'freehand';
let lineColor = '#000000';
let lineThickness = 2;
let isDrawing = false;
let lastX = null, lastY = null;
let lines = [];

function resizeCanvas() {
    canvas.width = tacticBoard.clientWidth;
    canvas.height = tacticBoard.clientHeight;
    redrawLines();
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

settingsButton.addEventListener('click', () => {
    settingsTab.style.display = 'block';
});

closeSettingsButton.addEventListener('click', () => {
    settingsTab.style.display = 'none';
});

colorPicker.addEventListener('input', (event) => {
    lineColor = event.target.value;
});

lineThicknessSlider.addEventListener('input', (event) => {
    lineThickness = event.target.value;
});

drawingModeSelector.addEventListener('change', (event) => {
    drawingMode = event.target.value;
});

// Mouse drawing functionality
tacticBoard.addEventListener('mousedown', (event) => {
    if (event.target.classList.contains('player') || event.target.classList.contains('ball') || event.target.classList.contains('goalie')) {
        return;
    }
    isDrawing = true;
    [lastX, lastY] = [event.offsetX, event.offsetY];
});

tacticBoard.addEventListener('mousemove', (event) => {
    if (!isDrawing) return;

    ctx.strokeStyle = lineColor;
    ctx.lineWidth = lineThickness;
    ctx.lineCap = 'round';

    if (drawingMode === 'freehand') {
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(event.offsetX, event.offsetY);
        ctx.stroke();
        [lastX, lastY] = [event.offsetX, event.offsetY];
    } else if (drawingMode === 'straight') {
        redrawLines();
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(event.offsetX, event.offsetY);
        ctx.stroke();
    }
});

tacticBoard.addEventListener('mouseup', (event) => {
    if (!isDrawing) return;
    isDrawing = false;
    if (drawingMode === 'straight') {
        lines.push({
            startX: lastX,
            startY: lastY,
            endX: event.offsetX,
            endY: event.offsetY,
            color: lineColor,
            thickness: lineThickness
        });
        redrawLines();
    }
});

tacticBoard.addEventListener('mouseleave', () => {
    isDrawing = false;
});

// Touch drawing functionality
tacticBoard.addEventListener('touchstart', (event) => {
    if (event.target.classList.contains('player') || event.target.classList.contains('ball') || event.target.classList.contains('goalie')) {
        return;
    }
    isDrawing = true;
    const touch = event.touches[0];
    [lastX, lastY] = [touch.clientX - tacticBoard.offsetLeft, touch.clientY - tacticBoard.offsetTop];
    event.preventDefault();  // Prevent default behavior like scrolling
});

tacticBoard.addEventListener('touchmove', (event) => {
    if (!isDrawing) return;

    const touch = event.touches[0];
    const offsetX = touch.clientX - tacticBoard.offsetLeft;
    const offsetY = touch.clientY - tacticBoard.offsetTop;

    ctx.strokeStyle = lineColor;
    ctx.lineWidth = lineThickness;
    ctx.lineCap = 'round';

    if (drawingMode === 'freehand') {
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(offsetX, offsetY);
        ctx.stroke();
        [lastX, lastY] = [offsetX, offsetY];
    } else if (drawingMode === 'straight') {
        redrawLines();
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(offsetX, offsetY);
        ctx.stroke();
    }

    event.preventDefault();  // Prevent default behavior like scrolling
});

tacticBoard.addEventListener('touchend', (event) => {
    if (!isDrawing) return;
    isDrawing = false;
    if (drawingMode === 'straight') {
        lines.push({
            startX: lastX,
            startY: lastY,
            endX: event.changedTouches[0].clientX - tacticBoard.offsetLeft,
            endY: event.changedTouches[0].clientY - tacticBoard.offsetTop,
            color: lineColor,
            thickness: lineThickness
        });
        redrawLines();
    }
});

tacticBoard.addEventListener('touchcancel', () => {
    isDrawing = false;
});

// Function to redraw previously drawn lines
function redrawLines() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    lines.forEach(line => {
        ctx.strokeStyle = line.color;
        ctx.lineWidth = line.thickness;
        ctx.beginPath();
        ctx.moveTo(line.startX, line.startY);
        ctx.lineTo(line.endX, line.endY);
        ctx.stroke();
    });
}

// Handle player drag (for both mouse and touch events)
elements.forEach(element => {
    // Mouse event listeners
    element.addEventListener('mousedown', dragStart);

    // Touch event listeners
    element.addEventListener('touchstart', dragStartTouch);
});

function dragStart(e) {
    e.preventDefault();  // Prevent default behavior (e.g., text selection)
    const target = e.target;
    const startX = e.clientX - target.offsetLeft;
    const startY = e.clientY - target.offsetTop;

    function dragMove(e) {
        const newX = e.clientX - startX;
        const newY = e.clientY - startY;
        target.style.left = `${newX / tacticBoard.clientWidth * 100}%`;
        target.style.top = `${newY / tacticBoard.clientHeight * 100}%`;
    }

    function dragEnd() {
        document.removeEventListener('mousemove', dragMove);
        document.removeEventListener('mouseup', dragEnd);
    }

    document.addEventListener('mousemove', dragMove);
    document.addEventListener('mouseup', dragEnd);
}

function dragStartTouch(e) {
    e.preventDefault();  // Prevent default behavior (e.g., scrolling)
    const target = e.target;
    const touch = e.touches[0];  // Get the first touch point
    const startX = touch.clientX - target.offsetLeft;
    const startY = touch.clientY - target.offsetTop;

    function dragMoveTouch(e) {
        const touch = e.touches[0];  // Get updated touch point
        const newX = touch.clientX - startX;
        const newY = touch.clientY - startY;
        target.style.left = `${newX / tacticBoard.clientWidth * 100}%`;
        target.style.top = `${newY / tacticBoard.clientHeight * 100}%`;
    }

    function dragEndTouch() {
        document.removeEventListener('touchmove', dragMoveTouch);
        document.removeEventListener('touchend', dragEndTouch);
    }

    document.addEventListener('touchmove', dragMoveTouch);
    document.addEventListener('touchend', dragEndTouch);
}

// Reset button functionality
resetButton.addEventListener('click', () => {
    elements.forEach(element => {
        const startTop = element.getAttribute('data-start-top');
        const startLeft = element.getAttribute('data-start-left');
        element.style.top = startTop;
        element.style.left = startLeft;
    });
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    lines = [];
});

</script>
</body>
</html>
